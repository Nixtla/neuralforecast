---
output-file: models.fedformer.html
title: FEDformer
---

The FEDformer model tackles the challenge of finding reliable
dependencies on intricate temporal patterns of long-horizon forecasting.

The architecture has the following distinctive features: - In-built
progressive decomposition in trend and seasonal components based on a
moving average filter. - Frequency Enhanced Block and Frequency Enhanced
Attention to perform attention in the sparse representation on basis
such as Fourier transform. - Classic encoder-decoder proposed by Vaswani
et al. (2017) with a multi-head attention mechanism.

The FEDformer model utilizes a three-component approach to define its
embedding: - It employs encoded autoregressive features obtained from a
convolution network. - Absolute positional embeddings obtained from
calendar features are utilized.

**References**
 - [Zhou, Tian, Ziqing Ma, Qingsong Wen, Xue Wang,
Liang Sun, and Rong Jin.. “FEDformer: Frequency enhanced decomposed
transformer for long-term series
forecasting”](https://proceedings.mlr.press/v162/zhou22g.html)


![Figure 1. FEDformer Architecture.](imgs_models/fedformer.png)
*Figure 1. FEDformer
Architecture.*

## FEDformer

### `FEDformer`

```python
FEDformer(
    h,
    input_size,
    stat_exog_list=None,
    hist_exog_list=None,
    futr_exog_list=None,
    decoder_input_size_multiplier=0.5,
    version="Fourier",
    modes=64,
    mode_select="random",
    hidden_size=128,
    dropout=0.05,
    n_head=8,
    conv_hidden_size=32,
    activation="gelu",
    encoder_layers=2,
    decoder_layers=1,
    MovingAvg_window=25,
    loss=MAE(),
    valid_loss=None,
    max_steps=5000,
    learning_rate=0.0001,
    num_lr_decays=-1,
    early_stop_patience_steps=-1,
    val_check_steps=100,
    batch_size=32,
    valid_batch_size=None,
    windows_batch_size=1024,
    inference_windows_batch_size=1024,
    start_padding_enabled=False,
    training_data_availability_threshold=0.0,
    step_size=1,
    scaler_type="identity",
    random_seed=1,
    drop_last_loader=False,
    alias=None,
    optimizer=None,
    optimizer_kwargs=None,
    lr_scheduler=None,
    lr_scheduler_kwargs=None,
    dataloader_kwargs=None,
    **trainer_kwargs
)
```

Bases: <code>[BaseModel](#neuralforecast.common._base_model.BaseModel)</code>

FEDformer

The FEDformer model tackles the challenge of finding reliable dependencies on intricate temporal patterns of long-horizon forecasting.

The architecture has the following distinctive features:

- In-built progressive decomposition in trend and seasonal components based on a moving average filter.
- Frequency Enhanced Block and Frequency Enhanced Attention to perform attention in the sparse representation on basis such as Fourier transform.
- Classic encoder-decoder proposed by Vaswani et al. (2017) with a multi-head attention mechanism.

The FEDformer model utilizes a three-component approach to define its embedding:

- It employs encoded autoregressive features obtained from a convolution network.
- Absolute positional embeddings obtained from calendar features are utilized.

**Parameters:**

Name | Type | Description | Default
---- | ---- | ----------- | -------
`h` | <code>[int](#int)</code> | forecast horizon. | *required*
`input_size` | <code>[int](#int)</code> | maximum sequence length for truncated train backpropagation. | *required*
`stat_exog_list` | <code>[List](#List)\[[str](#str)\]</code> | static exogenous columns. | <code>None</code>
`hist_exog_list` | <code>[List](#List)\[[str](#str)\]</code> | historic exogenous columns. | <code>None</code>
`futr_exog_list` | <code>[List](#List)\[[str](#str)\]</code> | future exogenous columns. | <code>None</code>
`decoder_input_size_multiplier` | <code>[float](#float)</code> | multiplier for the input size of the decoder. | <code>0.5</code>
`version` | <code>[str](#str)</code> | version of the model. | <code>'Fourier'</code>
`modes` | <code>[int](#int)</code> | number of modes for the Fourier block. | <code>64</code>
`mode_select` | <code>[str](#str)</code> | method to select the modes for the Fourier block. | <code>'random'</code>
`hidden_size` | <code>[int](#int)</code> | units of embeddings and encoders. | <code>128</code>
`dropout` | <code>[float](#float)</code> | dropout throughout Autoformer architecture. | <code>0.05</code>
`n_head` | <code>[int](#int)</code> | controls number of multi-head's attention. | <code>8</code>
`conv_hidden_size` | <code>[int](#int)</code> | channels of the convolutional encoder. | <code>32</code>
`activation` | <code>[str](#str)</code> | activation from ['ReLU', 'Softplus', 'Tanh', 'SELU', 'LeakyReLU', 'PReLU', 'Sigmoid', 'GELU']. | <code>'gelu'</code>
`encoder_layers` | <code>[int](#int)</code> | number of layers for the TCN encoder. | <code>2</code>
`decoder_layers` | <code>[int](#int)</code> | number of layers for the MLP decoder. | <code>1</code>
`MovingAvg_window` | <code>[int](#int)</code> | window size for the moving average filter. | <code>25</code>
`loss` | <code>PyTorch module</code> | instantiated train loss class from [losses collection](./losses.pytorch). | <code>[MAE](#neuralforecast.losses.pytorch.MAE)()</code>
`valid_loss` | <code>PyTorch module</code> | instantiated validation loss class from [losses collection](./losses.pytorch). | <code>None</code>
`max_steps` | <code>[int](#int)</code> | maximum number of training steps. | <code>5000</code>
`learning_rate` | <code>[float](#float)</code> | Learning rate between (0, 1). | <code>0.0001</code>
`num_lr_decays` | <code>[int](#int)</code> | Number of learning rate decays, evenly distributed across max_steps. | <code>-1</code>
`early_stop_patience_steps` | <code>[int](#int)</code> | Number of validation iterations before early stopping. | <code>-1</code>
`val_check_steps` | <code>[int](#int)</code> | Number of training steps between every validation loss check. | <code>100</code>
`batch_size` | <code>[int](#int)</code> | number of different series in each batch. | <code>32</code>
`valid_batch_size` | <code>[int](#int)</code> | number of different series in each validation and test batch, if None uses batch_size. | <code>None</code>
`windows_batch_size` | <code>[int](#int)</code> | number of windows to sample in each training batch, default uses all. | <code>1024</code>
`inference_windows_batch_size` | <code>[int](#int)</code> | number of windows to sample in each inference batch. | <code>1024</code>
`start_padding_enabled` | <code>[bool](#bool)</code> | if True, the model will pad the time series with zeros at the beginning, by input size. | <code>False</code>
`training_data_availability_threshold` | <code>[Union](#Union)\[[float](#float), [List](#List)\[[float](#float)\]\]</code> | minimum fraction of valid data points required for training windows. Single float applies to both insample and outsample; list of two floats specifies [insample_fraction, outsample_fraction]. Default 0.0 allows windows with only 1 valid data point (current behavior). | <code>0.0</code>
`step_size` | <code>[int](#int)</code> | step size between each window of temporal data. | <code>1</code>
`scaler_type` | <code>[str](#str)</code> | type of scaler for temporal inputs normalization see [temporal scalers](https://github.com/Nixtla/neuralforecast/blob/main/neuralforecast/common/_scalers.py). | <code>'identity'</code>
`random_seed` | <code>[int](#int)</code> | random_seed for pytorch initializer and numpy generators. | <code>1</code>
`drop_last_loader` | <code>[bool](#bool)</code> | if True `TimeSeriesDataLoader` drops last non-full batch. | <code>False</code>
`alias` | <code>[str](#str)</code> | optional, Custom name of the model. | <code>None</code>
`optimizer` | <code>Subclass of 'torch.optim.Optimizer'</code> | optional, user specified optimizer instead of the default choice (Adam). | <code>None</code>
`optimizer_kwargs` | <code>[dict](#dict)</code> | optional, list of parameters used by the user specified optimizer. | <code>None</code>
`lr_scheduler` | <code>Subclass of 'torch.optim.lr_scheduler.LRScheduler'</code> | optional, user specified lr_scheduler instead of the default choice (StepLR). | <code>None</code>
`lr_scheduler_kwargs` | <code>[dict](#dict)</code> | optional, list of parameters used by the user specified lr_scheduler. | <code>None</code>
`dataloader_kwargs` | <code>[dict](#dict)</code> | optional, list of parameters passed into the PyTorch Lightning dataloader by the `TimeSeriesDataLoader`. | <code>None</code>
`**trainer_kwargs` | <code>[int](#int)</code> | keyword trainer arguments inherited from [PyTorch Lighning's trainer](https://pytorch-lightning.readthedocs.io/en/stable/api/pytorch_lightning.trainer.trainer.Trainer.html?highlight=trainer). | <code>{}</code>

<details class="references" open markdown="1">
<summary>References</summary>

- [Tian Zhou, et al. "FEDformer: Frequency Enhanced Decomposed Transformer for Long-term Series Forecasting" Proceedings of the AAAI conference on artificial intelligence. Vol. 37. No. 9. 2023."](https://arxiv.org/abs/2201.12740)

</details>

#### `FEDformer.fit`

```python
fit(
    dataset, val_size=0, test_size=0, random_seed=None, distributed_config=None
)
```

Fit.

The `fit` method, optimizes the neural network's weights using the
initialization parameters (`learning_rate`, `windows_batch_size`, ...)
and the `loss` function as defined during the initialization.
Within `fit` we use a PyTorch Lightning `Trainer` that
inherits the initialization's `self.trainer_kwargs`, to customize
its inputs, see [PL's trainer arguments](https://pytorch-lightning.readthedocs.io/en/stable/api/pytorch_lightning.trainer.trainer.Trainer.html?highlight=trainer).

The method is designed to be compatible with SKLearn-like classes
and in particular to be compatible with the StatsForecast library.

By default the `model` is not saving training checkpoints to protect
disk memory, to get them change `enable_checkpointing=True` in `__init__`.

Args:
dataset (TimeSeriesDataset): NeuralForecast's `TimeSeriesDataset`, see [documentation](./tsdataset).
val_size (int): Validation size for temporal cross-validation.
random_seed (int): Random seed for pytorch initializer and numpy generators, overwrites model.__init__'s.
test_size (int): Test size for temporal cross-validation.

Returns:
None

#### `FEDformer.predict`

```python
predict(
    dataset,
    test_size=None,
    step_size=1,
    random_seed=None,
    quantiles=None,
    h=None,
    explainer_config=None,
    **data_module_kwargs
)
```

Predict.

Neural network prediction with PL's `Trainer` execution of `predict_step`.

Args:
dataset (TimeSeriesDataset): NeuralForecast's `TimeSeriesDataset`, see [documentation](./tsdataset).
test_size (int): Test size for temporal cross-validation.
step_size (int): Step size between each window.
random_seed (int): Random seed for pytorch initializer and numpy generators, overwrites model.__init__'s.
quantiles (list): Target quantiles to predict.
h (int): Prediction horizon, if None, uses the model's fitted horizon. Defaults to None.
explainer_config (dict): configuration for explanations.
\*\*data_module_kwargs (dict): PL's TimeSeriesDataModule args, see [documentation](https://pytorch-lightning.readthedocs.io/en/1.6.1/extensions/datamodules.html#using-a-datamodule).

Returns:
None
